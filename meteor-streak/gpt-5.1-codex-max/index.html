<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Meteor Streak</title>
        <style>
            :root {
                --accent: #7fd2ff;
                --glow: #6fc8ff;
                --ember: #ffb35a;
                --panel: rgba(12, 18, 28, 0.72);
                --text: #e7efff;
                font-family: "Trebuchet MS", "Segoe UI", sans-serif;
                color: var(--text);
            }

            * {
                box-sizing: border-box;
            }

            body {
                margin: 0;
                background: #04060c;
                overflow: hidden;
                color: var(--text);
            }

            #scene {
                position: fixed;
                inset: 0;
                width: 100vw;
                height: 100vh;
                display: block;
                background: #05070f;
            }

            #panel {
                position: fixed;
                top: 18px;
                left: 18px;
                padding: 14px 16px 12px;
                background: var(--panel);
                border: 1px solid rgba(255, 255, 255, 0.08);
                border-radius: 12px;
                box-shadow: 0 12px 40px rgba(0, 0, 0, 0.45);
                backdrop-filter: blur(10px);
                color: var(--text);
                min-width: 230px;
            }

            #panel .title {
                font-weight: 700;
                letter-spacing: 0.4px;
                margin-bottom: 8px;
                font-size: 15px;
            }

            .control {
                display: grid;
                grid-template-columns: auto 1fr auto;
                align-items: center;
                gap: 10px;
                font-size: 13px;
            }

            .control input[type="range"] {
                -webkit-appearance: none;
                appearance: none;
                width: 100%;
                height: 6px;
                border-radius: 999px;
                background: linear-gradient(90deg, #10243c, #1d3f63);
                outline: none;
                box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
            }

            .control input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                background: var(--accent);
                border: 2px solid #0b1b30;
                box-shadow: 0 0 0 6px rgba(127, 210, 255, 0.2);
                cursor: pointer;
            }

            .control input[type="range"]::-moz-range-thumb {
                width: 16px;
                height: 16px;
                border-radius: 50%;
                background: var(--accent);
                border: 2px solid #0b1b30;
                box-shadow: 0 0 0 6px rgba(127, 210, 255, 0.2);
                cursor: pointer;
            }

            #speedValue {
                font-weight: 700;
                color: var(--accent);
                font-variant-numeric: tabular-nums;
                min-width: 48px;
                text-align: right;
            }

            .hint {
                margin-top: 8px;
                font-size: 12px;
                opacity: 0.78;
            }
        </style>
    </head>
    <body>
        <canvas id="scene"></canvas>
        <div id="panel">
            <div class="title">Meteor Streak</div>
            <label class="control" for="speed">
                <span class="label">Meteor speed</span>
                <input
                    type="range"
                    id="speed"
                    min="0.6"
                    max="2"
                    value="1.1"
                    step="0.05"
                />
                <span id="speedValue">1.10x</span>
            </label>
            <div class="hint">Click anywhere to call another meteor.</div>
        </div>

        <script>
            (() => {
                const canvas = document.getElementById("scene");
                const ctx = canvas.getContext("2d");
                const speedSlider = document.getElementById("speed");
                const speedValue = document.getElementById("speedValue");

                let meteorSpeed = parseFloat(speedSlider.value);
                let w = 0;
                let h = 0;
                let dpr = 1;
                let groundY = 0;
                let bgGradient = null;
                let glowGradient = null;
                let time = 0;
                let last = performance.now();

                const stars = [];
                const meteors = [];
                const impacts = [];
                const dust = [];
                const embers = [];

                const randomRange = (min, max) =>
                    Math.random() * (max - min) + min;

                function resize() {
                    w = window.innerWidth;
                    h = window.innerHeight;
                    dpr = window.devicePixelRatio || 1;
                    canvas.width = w * dpr;
                    canvas.height = h * dpr;
                    canvas.style.width = `${w}px`;
                    canvas.style.height = `${h}px`;
                    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
                    groundY = h * 0.82;
                    bgGradient = ctx.createLinearGradient(0, 0, 0, h);
                    bgGradient.addColorStop(0, "#040811");
                    bgGradient.addColorStop(0.55, "#060b15");
                    bgGradient.addColorStop(1, "#04060c");
                    glowGradient = ctx.createLinearGradient(
                        0,
                        groundY - 100,
                        0,
                        h
                    );
                    glowGradient.addColorStop(0, "rgba(20, 45, 70, 0)");
                    glowGradient.addColorStop(0.35, "rgba(26, 64, 100, 0.35)");
                    glowGradient.addColorStop(1, "rgba(12, 20, 32, 0.8)");
                    createStars(170);
                }

                function createStars(count) {
                    stars.length = 0;
                    for (let i = 0; i < count; i++) {
                        stars.push({
                            x: Math.random() * w,
                            y: Math.random() * h * 0.8,
                            r: randomRange(0.35, 1.6),
                            alpha: randomRange(0.4, 0.9),
                            phase: Math.random() * Math.PI * 2,
                        });
                    }
                }

                function drawStars(t) {
                    ctx.save();
                    for (const star of stars) {
                        const twinkle =
                            0.55 + 0.45 * Math.sin(t * 0.9 + star.phase);
                        ctx.globalAlpha = star.alpha * twinkle;
                        ctx.fillStyle = "#b7d7ff";
                        ctx.beginPath();
                        ctx.arc(star.x, star.y, star.r, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    ctx.restore();
                }

                function spawnMeteor(opts = {}) {
                    const targetX =
                        opts.targetX ??
                        w * 0.55 + randomRange(-w * 0.12, w * 0.12);
                    const targetY = opts.targetY ?? groundY - 6;
                    const entrySide = Math.random() < 0.55 ? "left" : "top";
                    let x;
                    let y;
                    if (entrySide === "left") {
                        x = -randomRange(80, 160);
                        y = randomRange(0, h * 0.45);
                    } else {
                        x = randomRange(0, w);
                        y = -randomRange(80, 160);
                    }

                    const dx = targetX - x;
                    const dy = targetY - y;
                    const dist = Math.hypot(dx, dy) || 1;
                    const baseSpeed = 1500; // tuned so the first streak crosses in about a second
                    const speed =
                        baseSpeed * meteorSpeed * (opts.speedMultiplier ?? 1);
                    const vx = (dx / dist) * speed;
                    const vy = (dy / dist) * speed;

                    meteors.push({
                        x,
                        y,
                        vx,
                        vy,
                        size: 3.1,
                        trail: [],
                        hue: randomRange(40, 65),
                        created: performance.now(),
                        targetY,
                        alive: true,
                    });
                }

                function createImpact(x, y) {
                    impacts.push({
                        x,
                        y,
                        radius: 14,
                        lineWidth: 3,
                        alpha: 0.75,
                        flashAlpha: 0.45,
                        maxRadius: Math.max(w * 0.45, 320),
                    });
                    spawnDust(x, y);
                    spawnEmbers(x, y);
                }

                function spawnDust(x, y) {
                    const count = 42;
                    for (let i = 0; i < count; i++) {
                        const angle = randomRange(
                            -Math.PI * 0.78,
                            -Math.PI * 0.22
                        );
                        const speed = randomRange(220, 620);
                        dust.push({
                            x,
                            y,
                            vx: Math.cos(angle) * speed,
                            vy: Math.sin(angle) * speed,
                            life: randomRange(0.9, 1.3),
                            age: 0,
                            size: randomRange(2, 4.5),
                        });
                    }
                }

                function spawnEmbers(x, y) {
                    const count = 26;
                    for (let i = 0; i < count; i++) {
                        const angle = randomRange(
                            -Math.PI * 0.82,
                            -Math.PI * 0.25
                        );
                        const speed = randomRange(60, 140);
                        embers.push({
                            x: x + randomRange(-8, 8),
                            y: y + randomRange(-6, 2),
                            vx: Math.cos(angle) * speed,
                            vy: Math.sin(angle) * speed,
                            life: randomRange(1.5, 2.8),
                            age: 0,
                            size: randomRange(1.2, 2.2),
                            drift: randomRange(-16, 16),
                        });
                    }
                }

                function updateMeteors(dt) {
                    for (let i = meteors.length - 1; i >= 0; i--) {
                        const m = meteors[i];
                        m.x += m.vx * dt;
                        m.y += m.vy * dt;
                        m.trail.push({ x: m.x, y: m.y });
                        if (m.trail.length > 14) m.trail.shift();

                        if (m.y >= m.targetY) {
                            createImpact(m.x, m.targetY);
                            meteors.splice(i, 1);
                            continue;
                        }

                        if (m.x > w + 200 || m.y > h + 200) {
                            meteors.splice(i, 1);
                        }
                    }
                }

                function drawMeteors() {
                    ctx.save();
                    for (const m of meteors) {
                        const head = m.trail[m.trail.length - 1] || m;
                        const tail = m.trail[0] || m;
                        const grad = ctx.createLinearGradient(
                            tail.x,
                            tail.y,
                            head.x,
                            head.y
                        );
                        grad.addColorStop(0, `hsla(${m.hue}, 90%, 70%, 0)`);
                        grad.addColorStop(
                            0.35,
                            `hsla(${m.hue}, 90%, 70%, 0.6)`
                        );
                        grad.addColorStop(1, "#d9f7ff");

                        ctx.strokeStyle = grad;
                        ctx.lineWidth = 3.2;
                        ctx.lineCap = "round";
                        ctx.shadowColor = "#92e5ff";
                        ctx.shadowBlur = 18;
                        ctx.beginPath();
                        ctx.moveTo(tail.x, tail.y);
                        ctx.lineTo(head.x, head.y);
                        ctx.stroke();

                        ctx.shadowBlur = 26;
                        ctx.fillStyle = "#dff6ff";
                        ctx.beginPath();
                        ctx.arc(head.x, head.y, 3.6, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    ctx.restore();
                }

                function updateImpacts(dt) {
                    for (let i = impacts.length - 1; i >= 0; i--) {
                        const impact = impacts[i];
                        impact.radius += 850 * dt;
                        impact.lineWidth += 120 * dt;
                        impact.alpha -= dt * 0.65;
                        impact.flashAlpha -= dt * 1.2;
                        if (impact.alpha <= 0 && impact.flashAlpha <= 0) {
                            impacts.splice(i, 1);
                        }
                    }
                }

                function drawImpacts() {
                    ctx.save();
                    for (const impact of impacts) {
                        if (impact.flashAlpha > 0) {
                            ctx.globalAlpha = impact.flashAlpha;
                            const flash = ctx.createRadialGradient(
                                impact.x,
                                impact.y,
                                0,
                                impact.x,
                                impact.y,
                                impact.radius * 1.1
                            );
                            flash.addColorStop(0, "rgba(255, 255, 255, 0.7)");
                            flash.addColorStop(1, "rgba(120, 200, 255, 0)");
                            ctx.fillStyle = flash;
                            ctx.beginPath();
                            ctx.arc(
                                impact.x,
                                impact.y,
                                impact.radius * 1.1,
                                0,
                                Math.PI * 2
                            );
                            ctx.fill();
                        }

                        if (impact.alpha > 0) {
                            ctx.globalAlpha = impact.alpha;
                            ctx.lineWidth = impact.lineWidth;
                            const ring = ctx.createRadialGradient(
                                impact.x,
                                impact.y,
                                impact.radius * 0.4,
                                impact.x,
                                impact.y,
                                impact.radius
                            );
                            ring.addColorStop(0, "rgba(140, 210, 255, 0.9)");
                            ring.addColorStop(1, "rgba(140, 210, 255, 0)");
                            ctx.strokeStyle = ring;
                            ctx.beginPath();
                            ctx.arc(
                                impact.x,
                                impact.y,
                                impact.radius,
                                0,
                                Math.PI * 2
                            );
                            ctx.stroke();
                        }
                    }
                    ctx.restore();
                }

                function updateDust(dt) {
                    const gravity = 1200;
                    for (let i = dust.length - 1; i >= 0; i--) {
                        const p = dust[i];
                        p.age += dt;
                        p.vy += gravity * dt;
                        p.vx *= 0.985;
                        p.vy *= 0.99;
                        p.x += p.vx * dt;
                        p.y += p.vy * dt;
                        if (p.age >= p.life) dust.splice(i, 1);
                    }
                }

                function drawDust() {
                    ctx.save();
                    for (const p of dust) {
                        const alpha = Math.max(0, 1 - p.age / p.life);
                        ctx.globalAlpha = alpha * 0.8;
                        const smoke = ctx.createRadialGradient(
                            p.x,
                            p.y,
                            0,
                            p.x,
                            p.y,
                            p.size * 3
                        );
                        smoke.addColorStop(0, "rgba(140, 150, 165, 0.7)");
                        smoke.addColorStop(1, "rgba(90, 110, 135, 0)");
                        ctx.fillStyle = smoke;
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    ctx.restore();
                }

                function updateEmbers(dt) {
                    for (let i = embers.length - 1; i >= 0; i--) {
                        const e = embers[i];
                        e.age += dt;
                        e.vx += e.drift * dt * 0.05;
                        e.vy += 40 * dt;
                        e.vx *= 0.99;
                        e.x += e.vx * dt;
                        e.y += e.vy * dt;
                        if (e.age >= e.life) embers.splice(i, 1);
                    }
                }

                function drawEmbers() {
                    ctx.save();
                    ctx.globalCompositeOperation = "lighter";
                    for (const e of embers) {
                        const alpha = Math.max(0, 1 - e.age / e.life);
                        ctx.globalAlpha = alpha;
                        ctx.fillStyle = `hsla(${randomRange(
                            26,
                            42
                        )}, 100%, 64%, ${alpha})`;
                        ctx.shadowColor = "rgba(255, 170, 90, 0.6)";
                        ctx.shadowBlur = 14;
                        ctx.beginPath();
                        ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    ctx.restore();
                }

                function drawBackground() {
                    ctx.fillStyle = bgGradient;
                    ctx.fillRect(0, 0, w, h);
                    ctx.fillStyle = glowGradient;
                    ctx.fillRect(0, groundY - 140, w, h - (groundY - 140));
                    ctx.fillStyle = "rgba(7, 10, 16, 0.8)";
                    ctx.fillRect(0, groundY, w, h - groundY);
                }

                function step(now) {
                    const dt = Math.min(0.033, (now - last) / 1000);
                    last = now;
                    time += dt;

                    updateMeteors(dt);
                    updateImpacts(dt);
                    updateDust(dt);
                    updateEmbers(dt);

                    drawBackground();
                    drawStars(time);
                    drawMeteors();
                    drawImpacts();
                    drawDust();
                    drawEmbers();

                    requestAnimationFrame(step);
                }

                speedSlider.addEventListener("input", () => {
                    meteorSpeed = parseFloat(speedSlider.value);
                    speedValue.textContent = `${meteorSpeed.toFixed(2)}x`;
                });

                canvas.addEventListener("click", (event) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = event.clientX - rect.left;
                    spawnMeteor({ targetX: x + randomRange(-40, 40) });
                });

                window.addEventListener("resize", resize);

                resize();
                speedValue.textContent = `${meteorSpeed.toFixed(2)}x`;
                spawnMeteor({ targetX: w * 0.6, speedMultiplier: 1.1 });
                requestAnimationFrame(step);
            })();
        </script>
    </body>
</html>
