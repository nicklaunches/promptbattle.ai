<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Meteor Impact Night Sky</title>
        <style>
            body {
                margin: 0;
                overflow: hidden;
                background: #000;
            }
            canvas {
                display: block;
            }
            #controls {
                position: absolute;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.5);
                padding: 10px 20px;
                border-radius: 10px;
                color: white;
                font-family: Arial, sans-serif;
            }
            label {
                margin-right: 15px;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas"></canvas>
        <div id="controls">
            <label
                >Meteor speed:
                <input
                    type="range"
                    id="speed"
                    min="0.2"
                    max="2"
                    step="0.1"
                    value="1"
            /></label>
            <span id="speedValue">1.0×</span>
            <button id="newMeteor">New Meteor</button>
        </div>

        <script>
            // Canvas setup
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");
            let width, height;

            function resize() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            }
            resize();
            window.addEventListener("resize", resize);

            // Controls
            const speedSlider = document.getElementById("speed");
            const speedValue = document.getElementById("speedValue");
            const newBtn = document.getElementById("newMeteor");

            speedValue.textContent = speedSlider.value + "×";
            let speedMultiplier = parseFloat(speedSlider.value);

            speedSlider.addEventListener("input", () => {
                speedMultiplier = parseFloat(speedSlider.value);
                speedValue.textContent = speedMultiplier.toFixed(1) + "×";
            });

            // Stars
            const stars = [];
            for (let i = 0; i < 300; i++) {
                stars.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    size: Math.random() * 1.5 + 0.5,
                    brightness: Math.random() * 0.8 + 0.2,
                });
            }

            // Particles and effects
            let meteors = [];
            let shockwaves = [];
            let dustParticles = [];
            let embers = [];

            class Meteor {
                constructor() {
                    this.reset();
                }
                reset() {
                    const side = Math.random() < 0.5 ? "left" : "right";
                    this.startX = side === "left" ? -50 : width + 50;
                    this.startY = height * (0.1 + Math.random() * 0.4);
                    this.angle =
                        side === "left"
                            ? Math.PI * 0.75 + Math.random() * Math.PI * 0.2
                            : Math.PI * 0.25 - Math.random() * Math.PI * 0.2;
                    this.speed = 800 * speedMultiplier; // base speed in px/s
                    this.length = 80;
                    this.x = this.startX;
                    this.y = this.startY;
                    this.t = 0; // time since spawn
                    this.trail = [];
                    this.active = true;
                    this.impactX = null;
                    this.impactY = null;
                }
                update(dt) {
                    if (!this.active) return;
                    this.t += dt;
                    const dist = this.speed * this.t;
                    this.x = this.startX + Math.cos(this.angle) * dist;
                    this.y = this.startY + Math.sin(this.angle) * dist;

                    // Trail points
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > 20) this.trail.shift();

                    // Check ground impact (near bottom)
                    if (this.y >= height - 50) {
                        this.active = false;
                        this.impactX = this.x;
                        this.impactY = height - 30;

                        // Create shockwave
                        shockwaves.push({
                            x: this.impactX,
                            y: this.impactY,
                            radius: 0,
                            maxRadius: 400,
                            alpha: 1,
                        });

                        // Dust particles
                        for (let i = 0; i < 80; i++) {
                            const angle = Math.random() * Math.PI * 2;
                            const force = 100 + Math.random() * 200;
                            dustParticles.push({
                                x: this.impactX,
                                y: this.impactY,
                                vx: Math.cos(angle) * force,
                                vy: Math.sin(angle) * force - 200, // upward bias
                                life: 1,
                                decay: 0.005 + Math.random() * 0.005,
                                size: Math.random() * 4 + 2,
                            });
                        }

                        // Embers drifting upward
                        for (let i = 0; i < 40; i++) {
                            embers.push({
                                x: this.impactX + (Math.random() - 0.5) * 50,
                                y: this.impactY,
                                vx: (Math.random() - 0.5) * 50,
                                vy: -50 - Math.random() * 100,
                                life: 1,
                                decay: 0.008,
                                size: Math.random() * 3 + 1,
                            });
                        }
                    }
                }
                draw() {
                    if (!this.active && this.t < 1) return; // hide after first second if no impact yet

                    // Trail
                    ctx.strokeStyle = "rgba(255,200,100,0.6)";
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    let first = true;
                    for (const p of this.trail) {
                        if (first) {
                            ctx.moveTo(p.x, p.y);
                            first = false;
                        } else ctx.lineTo(p.x, p.y);
                    }
                    ctx.stroke();

                    // Head glow
                    const grad = ctx.createRadialGradient(
                        this.x,
                        this.y,
                        0,
                        this.x,
                        this.y,
                        20
                    );
                    grad.addColorStop(0, "white");
                    grad.addColorStop(0.3, "rgba(255,220,150,0.8)");
                    grad.addColorStop(1, "rgba(255,150,50,0)");
                    ctx.fillStyle = grad;
                    ctx.fillRect(this.x - 20, this.y - 20, 40, 40);

                    // Core
                    ctx.fillStyle = "white";
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Spawn initial meteor
            meteors.push(new Meteor());

            newBtn.addEventListener("click", () => {
                meteors.push(new Meteor());
            });
            canvas.addEventListener("click", () => {
                meteors.push(new Meteor());
            });

            // Animation loop
            let lastTime = 0;
            function animate(time) {
                if (!lastTime) lastTime = time;
                const dt = (time - lastTime) / 1000;
                lastTime = time;

                ctx.fillStyle = "#000811";
                ctx.fillRect(0, 0, width, height);

                // Draw stars
                stars.forEach((s) => {
                    ctx.fillStyle = `rgba(255,255,255,${s.brightness})`;
                    ctx.beginPath();
                    ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
                    ctx.fill();
                });

                // Update & draw meteors
                meteors = meteors.filter((m) => {
                    m.update(dt);
                    if (m.active || m.t < 2) {
                        // keep drawing trail briefly after impact
                        m.draw();
                        return true;
                    }
                    return false;
                });

                // Shockwaves
                shockwaves = shockwaves.filter((s) => {
                    s.radius += dt * 600;
                    s.alpha = 1 - s.radius / s.maxRadius;
                    if (s.alpha <= 0) return false;

                    ctx.strokeStyle = `rgba(255,180,100,${s.alpha * 0.6})`;
                    ctx.lineWidth = 8;
                    ctx.beginPath();
                    ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
                    ctx.stroke();

                    ctx.strokeStyle = `rgba(255,220,150,${s.alpha * 0.3})`;
                    ctx.lineWidth = 20;
                    ctx.beginPath();
                    ctx.arc(s.x, s.y, s.radius * 0.8, 0, Math.PI * 2);
                    ctx.stroke();

                    return true;
                });

                // Dust particles
                dustParticles = dustParticles.filter((p) => {
                    p.x += p.vx * dt;
                    p.y += p.vy * dt;
                    p.vy += 300 * dt; // gravity
                    p.life -= p.decay;
                    if (p.life <= 0) return false;

                    ctx.fillStyle = `rgba(200,140,80,${p.life})`;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                    ctx.fill();
                    return true;
                });

                // Embers
                embers = embers.filter((e) => {
                    e.x += e.vx * dt;
                    e.y += e.vy * dt;
                    e.vy += -50 * dt; // slight upward buoyancy then fall
                    e.life -= e.decay;
                    if (e.life <= 0) return false;

                    const grad = ctx.createRadialGradient(
                        e.x,
                        e.y,
                        0,
                        e.x,
                        e.y,
                        e.size * 4
                    );
                    grad.addColorStop(0, `rgba(255,180,50,${e.life})`);
                    grad.addColorStop(0.5, `rgba(255,100,0,${e.life * 0.6})`);
                    grad.addColorStop(1, "rgba(255,50,0,0)");
                    ctx.fillStyle = grad;
                    ctx.fillRect(
                        e.x - e.size * 2,
                        e.y - e.size * 2,
                        e.size * 4,
                        e.size * 4
                    );
                    return true;
                });

                // Ground line
                ctx.strokeStyle = "#223";
                ctx.lineWidth = 40;
                ctx.beginPath();
                ctx.moveTo(0, height - 20);
                ctx.lineTo(width, height - 20);
                ctx.stroke();

                requestAnimationFrame(animate);
            }
            requestAnimationFrame(animate);
        </script>
    </body>
</html>
