<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Playful Crosswalk Chaos</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                background-color: #8bc34a; /* Grass green */
                font-family: sans-serif;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
            }

            #scene {
                position: relative;
                width: 800px;
                height: 600px;
                background-color: #8bc34a;
                overflow: hidden;
                border: 5px solid #558b2f;
                border-radius: 10px;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            }

            /* Road */
            .road {
                position: absolute;
                top: 50%;
                left: 0;
                width: 100%;
                height: 140px;
                background-color: #555;
                transform: translateY(-50%);
                z-index: 1;
            }

            .stripe {
                position: absolute;
                top: 50%;
                left: 0;
                width: 100%;
                height: 4px;
                background: repeating-linear-gradient(
                    to right,
                    #fff 0,
                    #fff 40px,
                    transparent 40px,
                    transparent 80px
                );
                transform: translateY(-50%);
            }

            /* Crosswalk */
            .crosswalk {
                position: absolute;
                top: 50%;
                left: 50%;
                width: 100px;
                height: 140px;
                transform: translate(-50%, -50%);
                z-index: 2;
                display: flex;
                flex-direction: column;
                justify-content: space-evenly;
            }

            .cw-stripe {
                height: 15px;
                background-color: #eee;
                width: 100%;
            }

            /* Traffic Light */
            .traffic-light {
                position: absolute;
                top: 100px;
                left: 50%;
                transform: translateX(60px);
                width: 40px;
                height: 100px;
                background-color: #333;
                border-radius: 10px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: space-around;
                padding: 5px 0;
                z-index: 10;
                cursor: pointer;
                box-shadow: 2px 5px 10px rgba(0, 0, 0, 0.3);
            }

            .light {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                background-color: #222;
                transition: background-color 0.2s, box-shadow 0.2s;
            }

            .light.red.active {
                background-color: #ff4444;
                box-shadow: 0 0 15px #ff4444;
            }
            .light.yellow.active {
                background-color: #ffeb3b;
                box-shadow: 0 0 15px #ffeb3b;
            }
            .light.green.active {
                background-color: #4caf50;
                box-shadow: 0 0 15px #4caf50;
            }

            /* Car */
            .car {
                position: absolute;
                top: 50%;
                left: -200px; /* Start off screen */
                width: 80px;
                height: 50px;
                background-color: #ff5722;
                border-radius: 8px;
                transform: translateY(-50%);
                z-index: 5;
                box-shadow: 2px 4px 8px rgba(0, 0, 0, 0.3);
            }

            .car::after {
                /* Windshield */
                content: "";
                position: absolute;
                top: 5px;
                right: 15px;
                width: 15px;
                height: 40px;
                background-color: #333;
                border-radius: 2px;
                opacity: 0.5;
            }

            .car::before {
                /* Headlights */
                content: "";
                position: absolute;
                top: -2px;
                right: 0;
                width: 5px;
                height: 54px;
                background: transparent;
                box-shadow: 0 4px 0 #ffe082, 0 46px 0 #ffe082;
            }

            /* Tire Smoke */
            .smoke {
                position: absolute;
                background-color: rgba(200, 200, 200, 0.8);
                border-radius: 50%;
                opacity: 0;
                pointer-events: none;
                z-index: 4;
            }

            /* Pedestrians */
            .pedestrian {
                position: absolute;
                width: 20px;
                height: 20px;
                background-color: #2196f3;
                border-radius: 50%;
                z-index: 6;
                box-shadow: 1px 2px 4px rgba(0, 0, 0, 0.2);
                transition: top 2s linear, bottom 2s linear;
            }

            .pedestrian::after {
                /* Head/Hat */
                content: "";
                position: absolute;
                top: 2px;
                left: 2px;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                background-color: rgba(255, 255, 255, 0.3);
            }

            /* Animations */
            @keyframes skidIn {
                0% {
                    left: -200px;
                    transform: translateY(-50%) rotate(0deg);
                }
                60% {
                    left: 300px;
                    transform: translateY(-50%) rotate(0deg);
                }
                80% {
                    left: 320px;
                    transform: translateY(-50%) rotate(5deg);
                } /* Skid tilt */
                100% {
                    left: 310px;
                    transform: translateY(-50%) rotate(0deg);
                } /* Settle */
            }

            @keyframes driveOff {
                0% {
                    left: 310px;
                }
                100% {
                    left: 900px;
                }
            }

            @keyframes wobble {
                0% {
                    transform: translateY(-50%) rotate(0deg) scale(1);
                }
                25% {
                    transform: translateY(-50%) rotate(-5deg) scale(1.1);
                }
                50% {
                    transform: translateY(-50%) rotate(5deg) scale(1.1);
                }
                75% {
                    transform: translateY(-50%) rotate(-5deg) scale(1.1);
                }
                100% {
                    transform: translateY(-50%) rotate(0deg) scale(1);
                }
            }

            /* Specific wobble for traffic light (different transform origin) */
            @keyframes wobbleLight {
                0% {
                    transform: translateX(60px) rotate(0deg) scale(1);
                }
                25% {
                    transform: translateX(60px) rotate(-5deg) scale(1.1);
                }
                50% {
                    transform: translateX(60px) rotate(5deg) scale(1.1);
                }
                75% {
                    transform: translateX(60px) rotate(-5deg) scale(1.1);
                }
                100% {
                    transform: translateX(60px) rotate(0deg) scale(1);
                }
            }

            /* Specific wobble for pedestrians (simple) */
            @keyframes wobblePed {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.3);
                }
                100% {
                    transform: scale(1);
                }
            }

            @keyframes smokePuff {
                0% {
                    opacity: 0.8;
                    transform: scale(0.5);
                }
                100% {
                    opacity: 0;
                    transform: scale(2) translate(-20px, -20px);
                }
            }

            /* Controls */
            #honk-btn {
                margin-top: 20px;
                padding: 15px 30px;
                font-size: 20px;
                font-weight: bold;
                color: white;
                background-color: #ff9800;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                box-shadow: 0 4px #e65100;
                transition: all 0.1s;
            }

            #honk-btn:active {
                box-shadow: 0 0 #e65100;
                transform: translateY(4px);
            }
        </style>
    </head>
    <body>
        <div id="scene">
            <div class="road">
                <div class="stripe"></div>
            </div>
            <div class="crosswalk">
                <div class="cw-stripe"></div>
                <div class="cw-stripe"></div>
                <div class="cw-stripe"></div>
                <div class="cw-stripe"></div>
                <div class="cw-stripe"></div>
                <div class="cw-stripe"></div>
            </div>

            <div class="traffic-light" id="traffic-light">
                <div class="light red active"></div>
                <div class="light yellow"></div>
                <div class="light green"></div>
            </div>

            <!-- Car will be inserted by JS or present initially -->
            <div class="car" id="hero-car"></div>
        </div>

        <button id="honk-btn">HONK!</button>

        <script>
            const car = document.getElementById("hero-car");
            const trafficLight = document.getElementById("traffic-light");
            const honkBtn = document.getElementById("honk-btn");
            const scene = document.getElementById("scene");
            const lights = {
                red: document.querySelector(".light.red"),
                yellow: document.querySelector(".light.yellow"),
                green: document.querySelector(".light.green"),
            };

            let lightState = "red"; // red, green, yellow
            let carState = "initial"; // initial, stopped, moving

            // --- Initialization ---

            function init() {
                // Instant skid in
                carSkidIn();
                startPedestriansCycle();
            }

            function carSkidIn() {
                carState = "moving";
                car.style.animation =
                    "skidIn 0.8s cubic-bezier(0.1, 0.7, 0.1, 1) forwards";

                // Create smoke near the end of the skid
                setTimeout(() => {
                    createSmoke(300, 280); // Rear tires approx position
                    createSmoke(300, 320);
                }, 500);

                car.addEventListener(
                    "animationend",
                    () => {
                        car.style.animation = "none";
                        car.style.left = "310px"; // Stopped position before crosswalk
                        carState = "stopped";

                        // If light is green when we arrive (unlikely on init, but possible), move again
                        if (lightState === "green") {
                            carDriveOff();
                        }
                    },
                    { once: true }
                );
            }

            function createSmoke(x, y) {
                for (let i = 0; i < 5; i++) {
                    const puff = document.createElement("div");
                    puff.classList.add("smoke");
                    const size = Math.random() * 20 + 10;
                    puff.style.width = `${size}px`;
                    puff.style.height = `${size}px`;
                    puff.style.left = `${x + Math.random() * 20}px`;
                    puff.style.top = `${y + Math.random() * 40 - 20}px`;

                    puff.style.animation = `smokePuff 0.6s ease-out forwards`;
                    puff.style.animationDelay = `${i * 0.1}s`;

                    scene.appendChild(puff);
                    setTimeout(() => puff.remove(), 1000);
                }
            }

            function carDriveOff() {
                if (carState !== "stopped") return;
                carState = "moving";
                car.style.animation = "driveOff 2s ease-in forwards";

                car.addEventListener(
                    "animationend",
                    () => {
                        // Reset car to start for endless loop fun, or just leave it gone.
                        // Let's loop it for playfulness if the light is still green/yellow?
                        // Or just bring it back next time it turns red.
                        car.style.display = "none";
                        carState = "gone";
                    },
                    { once: true }
                );
            }

            function resetCar() {
                // Bring car back to start
                car.style.display = "block";
                car.style.animation = "none";
                car.style.left = "-200px";
                carState = "initial";

                // Trigger skid in
                setTimeout(carSkidIn, 100);
            }

            // --- Traffic Light Logic ---

            trafficLight.addEventListener("click", toggleLight);

            function toggleLight() {
                // Cycle: Red -> Green -> Yellow -> Red
                if (lightState === "red") {
                    setLight("green");
                } else if (lightState === "green") {
                    setLight("yellow");
                } else if (lightState === "yellow") {
                    setLight("red");
                }
            }

            function setLight(newState) {
                lightState = newState;

                // UI Update
                lights.red.classList.remove("active");
                lights.yellow.classList.remove("active");
                lights.green.classList.remove("active");
                lights[newState].classList.add("active");

                // Logic
                if (newState === "green") {
                    stopPedestrians();
                    if (carState === "stopped") {
                        setTimeout(carDriveOff, 500); // Slight reaction delay
                    }
                } else if (newState === "red") {
                    if (carState === "gone") {
                        resetCar();
                    }
                    startPedestriansCycle();
                } else if (newState === "yellow") {
                    stopPedestrians();
                    // If car is approaching it should stop, but our car is usually stopped or gone.
                }
            }

            // --- Pedestrians ---

            let pedestrianInterval;

            function startPedestriansCycle() {
                if (pedestrianInterval) clearInterval(pedestrianInterval);
                // Spawn a pedestrian every so often if red
                pedestrianInterval = setInterval(() => {
                    if (lightState === "red" && carState === "stopped") {
                        spawnPedestrian();
                    }
                }, 1000);
                spawnPedestrian(); // Immediate one
            }

            function stopPedestrians() {
                if (pedestrianInterval) clearInterval(pedestrianInterval);
            }

            function spawnPedestrian() {
                const ped = document.createElement("div");
                ped.classList.add("pedestrian");

                // Randomly start from top or bottom of crosswalk
                const startTop = Math.random() > 0.5;
                // Crosswalk center X is 50% of parent width (400px).
                // Crosswalk width is 100px. So range 350 to 450.
                const randomX = 360 + Math.random() * 80;

                ped.style.left = `${randomX}px`;

                if (startTop) {
                    ped.style.top = "150px"; // Above road
                    // Animate to bottom
                    setTimeout(() => {
                        ped.style.top = "450px";
                    }, 50);
                } else {
                    ped.style.top = "450px"; // Below road
                    setTimeout(() => {
                        ped.style.top = "150px";
                    }, 50);
                }

                scene.appendChild(ped);

                // Cleanup
                setTimeout(() => {
                    if (ped.parentNode) ped.remove();
                }, 2100);
            }

            // --- Honk Logic ---

            honkBtn.addEventListener("click", () => {
                // Play a sound if we could, but let's do visual wobble

                // Find nearby elements to the car
                // If car is gone, wobble everything?
                // "Makes nearby elements wobble"

                const carRect = car.getBoundingClientRect();
                const elements = document.querySelectorAll(
                    ".pedestrian, .traffic-light"
                );

                elements.forEach((el) => {
                    // Calculate distance is a bit overkill, let's just wobble all peds and the light
                    // Or checking distance to car if it exists
                    if (carState !== "gone") {
                        // Simple animation trigger
                    }

                    // Apply class/anim
                    if (el.classList.contains("traffic-light")) {
                        el.style.animation = "wobbleLight 0.3s ease-in-out";
                    } else {
                        el.style.animation = "wobblePed 0.3s ease-in-out";
                    }

                    el.addEventListener(
                        "animationend",
                        () => {
                            el.style.animation = "none";
                        },
                        { once: true }
                    );
                });

                // Wobble car too
                if (carState !== "gone") {
                    car.style.animation = "wobble 0.3s ease-in-out";
                    car.addEventListener(
                        "animationend",
                        () => {
                            car.style.animation = "none";
                        },
                        { once: true }
                    );
                }
            });

            // Run
            init();
        </script>
    </body>
</html>
