<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Crosswalk Chaos</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                background: #2d5a27;
                font-family: sans-serif;
                overflow: hidden;
            }
            .scene {
                position: relative;
                width: 600px;
                height: 500px;
                background: #2d5a27;
            }
            .road {
                position: absolute;
                top: 50%;
                left: 0;
                transform: translateY(-50%);
                width: 100%;
                height: 140px;
                background: #444;
            }
            .road-line {
                position: absolute;
                top: 50%;
                left: 0;
                transform: translateY(-50%);
                width: 100%;
                height: 4px;
                background: repeating-linear-gradient(
                    90deg,
                    #fff 0,
                    #fff 30px,
                    transparent 30px,
                    transparent 60px
                );
            }
            .crosswalk {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 80px;
                height: 140px;
                background: repeating-linear-gradient(
                    0deg,
                    #fff 0,
                    #fff 15px,
                    #444 15px,
                    #444 25px
                );
            }
            .traffic-light {
                position: absolute;
                top: 60px;
                right: 80px;
                width: 40px;
                height: 100px;
                background: #222;
                border-radius: 8px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: space-evenly;
                padding: 8px;
                cursor: pointer;
                z-index: 10;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            }
            .traffic-light::after {
                content: "";
                position: absolute;
                bottom: -30px;
                width: 8px;
                height: 30px;
                background: #333;
            }
            .light {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                background: #333;
                transition: all 0.2s;
            }
            .light.red.active {
                background: #ff3333;
                box-shadow: 0 0 20px #ff3333;
            }
            .light.yellow.active {
                background: #ffcc00;
                box-shadow: 0 0 20px #ffcc00;
            }
            .light.green.active {
                background: #33cc33;
                box-shadow: 0 0 20px #33cc33;
            }

            .car {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                width: 80px;
                height: 45px;
                transition: left 0.5s ease-out;
            }
            .car-body {
                position: relative;
                width: 100%;
                height: 100%;
                background: #e74c3c;
                border-radius: 8px;
            }
            .car-body::before {
                content: "";
                position: absolute;
                top: 8px;
                left: 15px;
                width: 50px;
                height: 20px;
                background: #c0392b;
                border-radius: 5px 5px 0 0;
            }
            .car-window {
                position: absolute;
                top: 10px;
                left: 20px;
                width: 40px;
                height: 15px;
                background: #85c1e9;
                border-radius: 3px;
            }
            .wheel {
                position: absolute;
                bottom: -5px;
                width: 14px;
                height: 14px;
                background: #222;
                border-radius: 50%;
            }
            .wheel.front {
                right: 8px;
            }
            .wheel.back {
                left: 8px;
            }

            .tire-smoke {
                position: absolute;
                bottom: 0;
                left: -30px;
                width: 60px;
                height: 30px;
                opacity: 0;
                pointer-events: none;
            }
            .smoke-puff {
                position: absolute;
                border-radius: 50%;
                background: rgba(200, 200, 200, 0.8);
                animation: puff 0.8s ease-out forwards;
            }
            @keyframes puff {
                0% {
                    transform: scale(0);
                    opacity: 0.8;
                }
                100% {
                    transform: scale(2) translateX(-20px);
                    opacity: 0;
                }
            }

            .pedestrian {
                position: absolute;
                width: 20px;
                height: 20px;
                transition: top 0.8s linear, left 0.8s linear;
            }
            .pedestrian-body {
                width: 100%;
                height: 100%;
                background: #3498db;
                border-radius: 50%;
                position: relative;
            }
            .pedestrian-body::after {
                content: "";
                position: absolute;
                top: 4px;
                left: 50%;
                transform: translateX(-50%);
                width: 8px;
                height: 8px;
                background: #fcd;
                border-radius: 50%;
            }
            .pedestrian.ped2 .pedestrian-body {
                background: #9b59b6;
            }
            .pedestrian.ped3 .pedestrian-body {
                background: #e67e22;
            }

            .honk-btn {
                margin-top: 20px;
                padding: 15px 40px;
                font-size: 20px;
                font-weight: bold;
                background: #f39c12;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                box-shadow: 0 4px 0 #d68910;
                transition: transform 0.1s, box-shadow 0.1s;
            }
            .honk-btn:active {
                transform: translateY(4px);
                box-shadow: 0 0 0 #d68910;
            }

            .wobble {
                animation: wobble 0.3s ease-in-out;
            }
            @keyframes wobble {
                0%,
                100% {
                    transform: translateY(-50%) rotate(0deg);
                }
                25% {
                    transform: translateY(-50%) rotate(-5deg);
                }
                75% {
                    transform: translateY(-50%) rotate(5deg);
                }
            }
            .pedestrian.wobble {
                animation: pedWobble 0.3s ease-in-out;
            }
            @keyframes pedWobble {
                0%,
                100% {
                    transform: rotate(0deg);
                }
                25% {
                    transform: rotate(-15deg);
                }
                75% {
                    transform: rotate(15deg);
                }
            }
            .traffic-light.wobble {
                animation: lightWobble 0.3s ease-in-out;
            }
            @keyframes lightWobble {
                0%,
                100% {
                    transform: rotate(0deg);
                }
                25% {
                    transform: rotate(-5deg);
                }
                75% {
                    transform: rotate(5deg);
                }
            }

            .skid-marks {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                height: 8px;
                background: rgba(30, 30, 30, 0.6);
                opacity: 0;
            }

            .car.skidding {
                animation: skid 0.6s ease-out;
            }
            @keyframes skid {
                0% {
                    transform: translateY(-50%) rotate(0deg);
                }
                30% {
                    transform: translateY(-50%) rotate(-8deg);
                }
                60% {
                    transform: translateY(-50%) rotate(5deg);
                }
                100% {
                    transform: translateY(-50%) rotate(0deg);
                }
            }
        </style>
    </head>
    <body>
        <div class="scene">
            <div class="road">
                <div class="road-line"></div>
                <div class="crosswalk"></div>
            </div>

            <div class="skid-marks" id="skidMarks"></div>

            <div class="traffic-light" id="trafficLight">
                <div class="light red active"></div>
                <div class="light yellow"></div>
                <div class="light green"></div>
            </div>

            <div class="car" id="car" style="left: -100px">
                <div class="car-body">
                    <div class="car-window"></div>
                    <div class="wheel front"></div>
                    <div class="wheel back"></div>
                </div>
                <div class="tire-smoke" id="tireSmoke"></div>
            </div>

            <div
                class="pedestrian ped1"
                id="ped1"
                style="left: 270px; top: 120px"
            >
                <div class="pedestrian-body"></div>
            </div>
            <div
                class="pedestrian ped2"
                id="ped2"
                style="left: 290px; top: 100px"
            >
                <div class="pedestrian-body"></div>
            </div>
            <div
                class="pedestrian ped3"
                id="ped3"
                style="left: 310px; top: 130px"
            >
                <div class="pedestrian-body"></div>
            </div>
        </div>

        <button class="honk-btn" id="honkBtn">ðŸš— HONK!</button>

        <script>
            const trafficLight = document.getElementById("trafficLight");
            const car = document.getElementById("car");
            const tireSmoke = document.getElementById("tireSmoke");
            const skidMarks = document.getElementById("skidMarks");
            const honkBtn = document.getElementById("honkBtn");
            const pedestrians = [
                document.getElementById("ped1"),
                document.getElementById("ped2"),
                document.getElementById("ped3"),
            ];

            const lights = {
                red: trafficLight.querySelector(".red"),
                yellow: trafficLight.querySelector(".yellow"),
                green: trafficLight.querySelector(".green"),
            };

            let currentLight = "red";
            const stopPosition = 180;
            const pedStartPositions = [
                { left: 270, top: 120 },
                { left: 290, top: 100 },
                { left: 310, top: 130 },
            ];
            const pedCrossPositions = [
                { left: 270, top: 340 },
                { left: 290, top: 360 },
                { left: 310, top: 320 },
            ];

            function setLight(color) {
                Object.values(lights).forEach((l) =>
                    l.classList.remove("active")
                );
                lights[color].classList.add("active");
                currentLight = color;

                if (color === "red") {
                    car.style.left = stopPosition + "px";
                    movePedestrians("cross");
                } else if (color === "yellow") {
                    movePedestrians("back");
                } else if (color === "green") {
                    car.style.transition = "left 2s linear";
                    car.style.left = "700px";
                    setTimeout(() => {
                        car.style.transition = "none";
                        car.style.left = "-100px";
                        setTimeout(() => {
                            car.style.transition = "left 0.5s ease-out";
                        }, 50);
                    }, 2500);
                }
            }

            function movePedestrians(action) {
                pedestrians.forEach((ped, i) => {
                    if (action === "cross") {
                        ped.style.top = pedCrossPositions[i].top + "px";
                    } else {
                        ped.style.top = pedStartPositions[i].top + "px";
                    }
                });
            }

            function createSmoke() {
                tireSmoke.innerHTML = "";
                tireSmoke.style.opacity = "1";
                for (let i = 0; i < 8; i++) {
                    const puff = document.createElement("div");
                    puff.className = "smoke-puff";
                    puff.style.width = 10 + Math.random() * 15 + "px";
                    puff.style.height = puff.style.width;
                    puff.style.left = Math.random() * 40 + "px";
                    puff.style.bottom = Math.random() * 20 + "px";
                    puff.style.animationDelay = Math.random() * 0.3 + "s";
                    tireSmoke.appendChild(puff);
                }
                setTimeout(() => {
                    tireSmoke.style.opacity = "0";
                }, 800);
            }

            function showSkidMarks() {
                skidMarks.style.left = "50px";
                skidMarks.style.width = stopPosition - 30 + "px";
                skidMarks.style.opacity = "1";
                setTimeout(() => {
                    skidMarks.style.opacity = "0";
                }, 2000);
            }

            // Initial scene setup
            setTimeout(() => {
                car.classList.add("skidding");
                car.style.left = stopPosition + "px";
                createSmoke();
                showSkidMarks();

                setTimeout(() => {
                    car.classList.remove("skidding");
                    movePedestrians("cross");
                }, 600);
            }, 500);

            // Traffic light click handler
            trafficLight.addEventListener("click", () => {
                if (currentLight === "red") {
                    setLight("yellow");
                } else if (currentLight === "yellow") {
                    setLight("green");
                } else {
                    setLight("red");
                }
            });

            // Honk button
            honkBtn.addEventListener("click", () => {
                // Play honk sound effect visually
                car.classList.add("wobble");
                trafficLight.classList.add("wobble");
                pedestrians.forEach((ped) => ped.classList.add("wobble"));

                setTimeout(() => {
                    car.classList.remove("wobble");
                    trafficLight.classList.remove("wobble");
                    pedestrians.forEach((ped) =>
                        ped.classList.remove("wobble")
                    );
                }, 300);
            });
        </script>
    </body>
</html>
