<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Self-Playing Pong</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                background: #e0d4c0; /* warm paper tone */
                overflow: hidden;
            }
            canvas {
                display: block;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            }
        </style>
    </head>
    <body>
        <canvas id="c"></canvas>
        <script>
            const canvas = document.getElementById("c");
            const ctx = canvas.getContext("2d");
            const WIDTH = 1000;
            const HEIGHT = 600;
            canvas.width = WIDTH;
            canvas.height = HEIGHT;

            // Subtle grain texture (drawn once, overlaid softly)
            const grain = document.createElement("canvas");
            grain.width = WIDTH;
            grain.height = HEIGHT;
            const gctx = grain.getContext("2d");
            const img = gctx.createImageData(WIDTH, HEIGHT);
            const data = img.data;
            for (let i = 0; i < data.length; i += 4) {
                const n = Math.random() * 40;
                data[i] = n;
                data[i + 1] = n - 10;
                data[i + 2] = n - 20;
                data[i + 3] = 30;
            }
            gctx.putImageData(img, 0, 0);

            // Game objects
            let ball = { x: WIDTH / 2, y: HEIGHT / 2, vx: 0, vy: 0, r: 15 };
            let leftP = { x: 50, y: HEIGHT / 2 - 60, w: 20, h: 120 };
            let rightP = { x: WIDTH - 70, y: HEIGHT / 2 - 60, w: 20, h: 120 };
            let leftScore = 0;
            let rightScore = 0;
            let shake = 0;
            let pongAlpha = 0;

            function resetBall(toRight) {
                ball.x = WIDTH / 2;
                ball.y = HEIGHT / 2;
                const speed = 6;
                ball.vx = toRight ? speed : -speed;
                ball.vy = (Math.random() - 0.5) * 10;
            }

            function update() {
                // AI paddles: track ball with reaction lag + occasional noise/error
                const leftNoise = (Math.random() - 0.5) * 70;
                const leftTarget = ball.y - leftP.h / 2 + leftNoise;
                leftP.y += (leftTarget - leftP.y) * 0.13;

                const rightNoise = (Math.random() - 0.5) * 70;
                const rightTarget = ball.y - rightP.h / 2 + rightNoise;
                rightP.y += (rightTarget - rightP.y) * 0.13;

                // Clamp paddles
                leftP.y = Math.max(0, Math.min(HEIGHT - leftP.h, leftP.y));
                rightP.y = Math.max(0, Math.min(HEIGHT - rightP.h, rightP.y));

                // Ball movement
                ball.x += ball.vx;
                ball.y += ball.vy;

                // Top/bottom bounce
                if (ball.y - ball.r < 0 || ball.y + ball.r > HEIGHT) {
                    ball.vy = -ball.vy;
                }

                // Left paddle hit
                if (
                    ball.vx < 0 &&
                    ball.x - ball.r <= leftP.x + leftP.w &&
                    ball.x + ball.r >= leftP.x &&
                    ball.y >= leftP.y &&
                    ball.y <= leftP.y + leftP.h
                ) {
                    ball.vx = -ball.vx * 1.04; // slight speed increase
                    const delta = ball.y - (leftP.y + leftP.h / 2);
                    ball.vy += delta * 0.18;
                    ball.x = leftP.x + leftP.w + ball.r;
                }

                // Right paddle hit
                if (
                    ball.vx > 0 &&
                    ball.x - ball.r <= rightP.x + rightP.w &&
                    ball.x + ball.r >= rightP.x &&
                    ball.y >= rightP.y &&
                    ball.y <= rightP.y + rightP.h
                ) {
                    ball.vx = -ball.vx * 1.04;
                    const delta = ball.y - (rightP.y + rightP.h / 2);
                    ball.vy += delta * 0.18;
                    ball.x = rightP.x - ball.r;
                }

                // Scoring
                if (ball.x < 0) {
                    rightScore++;
                    resetBall(true);
                    shake = 30;
                }
                if (ball.x > WIDTH) {
                    leftScore++;
                    resetBall(false);
                    shake = 30;
                }
            }

            function draw() {
                // Warm paper background
                ctx.fillStyle = "#f8ece0";
                ctx.fillRect(0, 0, WIDTH, HEIGHT);

                // Subtle grain overlay
                ctx.globalCompositeOperation = "soft-light";
                ctx.globalAlpha = 0.7;
                ctx.drawImage(grain, 0, 0);
                ctx.globalCompositeOperation = "source-over";
                ctx.globalAlpha = 1;

                // Center dashed line (ink style)
                ctx.strokeStyle = "rgba(0,0,0,0.15)";
                ctx.lineWidth = 5;
                ctx.setLineDash([20, 20]);
                ctx.beginPath();
                ctx.moveTo(WIDTH / 2, 0);
                ctx.lineTo(WIDTH / 2, HEIGHT);
                ctx.stroke();
                ctx.setLineDash([]);

                // Screen shake
                let sx = 0,
                    sy = 0;
                if (shake > 0) {
                    sx = (Math.random() - 0.5) * shake;
                    sy = (Math.random() - 0.5) * shake;
                    shake *= 0.85;
                    if (shake < 1) shake = 0;
                }
                ctx.save();
                ctx.translate(sx, sy);

                // Paddles (white fill, thick black ink outline)
                ctx.fillStyle = "#ffffff";
                ctx.strokeStyle = "#000000";
                ctx.lineWidth = 7;
                ctx.fillRect(leftP.x, leftP.y, leftP.w, leftP.h);
                ctx.strokeRect(leftP.x, leftP.y, leftP.w, leftP.h);
                ctx.fillRect(rightP.x, rightP.y, rightP.w, rightP.h);
                ctx.strokeRect(rightP.x, rightP.y, rightP.w, rightP.h);

                // Ball (punchy orange fill, black ink outline)
                ctx.fillStyle = "#ff4400";
                ctx.strokeStyle = "#000000";
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                // Scores (punchy orange with black ink outline)
                ctx.font = "bold 90px Arial, sans-serif";
                ctx.strokeStyle = "#000000";
                ctx.lineWidth = 6;
                ctx.fillStyle = "#ff4400";
                ctx.textAlign = "center";
                ctx.textBaseline = "top";
                ctx.strokeText(leftScore, WIDTH / 4, 50);
                ctx.fillText(leftScore, WIDTH / 4, 50);
                ctx.strokeText(rightScore, (3 * WIDTH) / 4, 50);
                ctx.fillText(rightScore, (3 * WIDTH) / 4, 50);

                // "PONG" stamp (fades out quickly)
                if (pongAlpha > 0) {
                    ctx.font = "bold 160px Impact, Arial, sans-serif";
                    ctx.strokeStyle = "#000000";
                    ctx.lineWidth = 12;
                    ctx.fillStyle = `rgba(255,68,0,${pongAlpha})`;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.strokeText("PONG", WIDTH / 2, HEIGHT / 2);
                    ctx.fillText("PONG", WIDTH / 2, HEIGHT / 2);
                    pongAlpha -= 0.01;
                }

                ctx.restore();
            }

            function loop() {
                update();
                draw();
                requestAnimationFrame(loop);
            }

            // Start instantly on load
            resetBall(Math.random() > 0.5);
            shake = 30;
            pongAlpha = 1;
            loop();
        </script>
    </body>
</html>
